function trackGoals(){mida.fetch("/test/goal","POST",{k:window._h_key},e=>{try{var a=JSON.parse(e);a&&a.length&&a.forEach(e=>{var a={goal_id:e.id,goal_type:e.type,goal_value:e.value,test_key:e.key};switch(a.goal_type){case"pageview":case"pageviewExact":case"pageviewWildcard":handlePageviewGoal(a);break;case"scrolling":handleScrollingGoal(a);break;case"duration":handleDurationGoal(a);break;case"clickOnElement":handleClickOnElementGoal(a);break;case"clickOnText":handleClickOnTextGoal(a);break;case"externalLink":handleExternalLinkGoal(a);break;case"formSubmit":handleFormSubmitGoal(a);break;case"revenue":handleRevenueGoal(a)}})}catch(e){console.error("Error in trackGoals:",e)}})}function handleRevenueGoal(e){window._revenueGoals||(window._revenueGoals=[]),window._revenueGoals.push({goal_id:e.goal_id,test_key:e.test_key,goal_value:e.goal_value})}function handlePageviewGoal(e){let a=!1,o=!1,t=!1;try{var n=new URL(e.goal_value.startsWith("http")?e.goal_value:"https://"+e.goal_value),l=new URL(window.location.href);a=removeWww(l.hostname+l.pathname)===removeWww(n.hostname+n.pathname),t=removeWww(l.href)===removeWww(n.href)}catch(e){console.error("Error parsing URLs:",e),a=!1,t=!1}o=regexMatchURL(removeProtocol(removeWww(window.location.href)),removeProtocol(removeWww(e.goal_value))),"pageviewExact"===e.goal_type&&(a=!1,o=!1),((a="pageviewWildcard"===e.goal_type?!1:a)||t||o)&&(e.goal_id&&mida.track("goal_"+e.goal_id),mida.converted(e.test_key))}function handleScrollingGoal(a){let o=a.goal_value,t=!1;document.onscroll=()=>{var e=scrollPerc(document.body);Math.round(e)>=Number(o)&&!t&&(t=!0,a.goal_id&&mida.track("goal_"+a.goal_id),mida.converted(a.test_key))}}function handleDurationGoal(e){var a=e.goal_value;setTimeout(()=>{e.goal_id&&mida.track("goal_"+e.goal_id),mida.converted(e.test_key)},1e3*a)}function handleClickOnElementGoal(n){setTimeout(()=>{var e=document.querySelectorAll(cleanSel(n.goal_value));let o=!1,t=!1;e&&0<e.length&&e.forEach(function(e){function a(e){o||(n.goal_id&&mida.track("goal_"+n.goal_id),mida.converted(n.test_key).then(function(){o=!0}))}e.addEventListener("touchstart",function(e){t=!0}),e.addEventListener("touchend",function(e){t&&(t=!1,a())}),e.addEventListener("click",function(e){t||a()})})},500)}function handleClickOnTextGoal(n){setTimeout(()=>{var e=document.querySelectorAll("*");const a=n.goal_value.trim().toLowerCase();Array.from(e).filter(e=>e.textContent.trim().toLowerCase()===a).forEach(e=>{let a=!1,o=!1;function t(e){a||(n.goal_id&&mida.track("goal_"+n.goal_id),mida.converted(n.test_key).then(function(){a=!0}))}e.addEventListener("touchstart",function(e){o=!0}),e.addEventListener("touchend",function(e){o&&(o=!1,t())}),e.addEventListener("click",function(e){o||t()})})},500)}function handleExternalLinkGoal(n){setTimeout(()=>{document.querySelectorAll(`a[href*="${n.goal_value}"]`).forEach(function(e){let a=!1,o=!1;function t(e){a||(n.goal_id&&mida.track("goal_"+n.goal_id),mida.converted(n.test_key).then(function(){a=!0}))}e.addEventListener("touchstart",function(e){o=!0}),e.addEventListener("touchend",function(e){o&&(o=!1,t())}),e.addEventListener("click",function(e){o||t()})})},500)}function handleFormSubmitGoal(a){setTimeout(()=>{console.log("setup form goal"),console.log(a.goal_value),console.log(cleanSel(a.goal_value));var e=document.querySelector(cleanSel(a.goal_value));e&&(console.log(a),console.log(e),e.addEventListener("submit",function(e){a.goal_id&&mida.track("goal_"+a.goal_id),mida.converted(a.test_key)}))},500)}function regexMatchURL(e,a){a="^"+a.replace(/\?/g,"\\?").replace(/\//g,"\\/").replace(/(\*|\%)/g,".*")+"$";a=new RegExp(a);return null!==e.match(a)}function removeWww(e){return"string"==typeof e?e.replace(/\/\/www\./g,"//").replace(/\/$/g,""):e}function removeProtocol(e){return e.replace(/(^\w+:|^)\/\//,"")}function cleanSel(e){return e.replace(/\#[0-9]/,function(e){return e.replace("#","#\\3")}).replace(/\.[0-9]/,function(e){return e.replace(".",".\\3")})}function scrollPerc(e){var a=e.parentNode;return(e.scrollTop||a.scrollTop)/(a.scrollHeight-a.clientHeight)*100}trackGoals();